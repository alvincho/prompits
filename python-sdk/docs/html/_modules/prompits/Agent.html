

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>prompits.Agent &mdash; Prompits 0.0.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=e3a6060d"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Prompits
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Prompits Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../prompits.html">prompits package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prompits.plazas.html">prompits.plazas package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prompits.pools.html">prompits.pools package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prompits.plugs.html">prompits.plugs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prompits.services.html">prompits.services package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../prompits.messages.html">prompits.messages package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Prompits</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">prompits.Agent</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for prompits.Agent</h1><div class="highlight"><pre>
<span></span><span class="c1"># Agent is a Pit and can host multiple pits.</span>
<span class="c1"># Agent&#39;s practices are the practices of the pits it hosts and it can use the practices of the pits it hosts.</span>
<span class="c1"># Agent is a software can be instantiated on a machine.</span>
<span class="c1"># Agent can communicate with other agents through multiple communication channels called Plug</span>
<span class="c1"># Agent can send and receive messages through plugs</span>

<span class="c1"># Agent can be described as a JSON object ToJson()</span>
<span class="c1"># Agent can be initialized from a JSON object __init__(json)</span>
<span class="c1"># Json contains environments (os, cpu, gpu, memory, etc.)</span>
<span class="c1"># Sample JSON:</span>
<span class="c1"># {</span>
<span class="c1">#     &quot;name&quot;: &quot;Agent1&quot;,</span>
<span class="c1">#     &quot;description&quot;: &quot;Agent1 description&quot;,</span>
<span class="c1">#     &quot;pits&quot;: [</span>
<span class="c1">#         {</span>
<span class="c1">#             &quot;name&quot;: &quot;Pit1&quot;,</span>
<span class="c1">#             &quot;description&quot;: &quot;Pit1 description&quot;</span>
<span class="c1">#         }</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;plugs&quot;: [</span>
<span class="c1">#         {</span>
<span class="c1">#             &quot;name&quot;: &quot;Plug1&quot;,</span>
<span class="c1">#             &quot;description&quot;: &quot;Plug1 description&quot;</span>
<span class="c1">#         }</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;environments&quot;: {</span>
<span class="c1">#         &quot;os&quot;: &quot;Linux&quot;,</span>
<span class="c1">#         &quot;cpu&quot;: {</span>
<span class="c1">#             &quot;model&quot;: &quot;Intel Core i7&quot;,</span>
<span class="c1">#             &quot;cores&quot;: 8,</span>
<span class="c1">#             &quot;threads&quot;: 16,</span>
<span class="c1">#             &quot;frequency&quot;: 3.5</span>
<span class="c1">#         },</span>
<span class="c1">#         &quot;gpu&quot;: {</span>
<span class="c1">#             &quot;model&quot;: &quot;NVIDIA GeForce RTX 3070&quot;,</span>
<span class="c1">#             &quot;memory&quot;: 8192,</span>
<span class="c1">#             &quot;cores&quot;: 24,</span>
<span class="c1">#             &quot;frequency&quot;: 1.7</span>
<span class="c1">#         },</span>
<span class="c1">#         &quot;memory&quot;: {</span>
<span class="c1">#             &quot;total&quot;: 16384,</span>
<span class="c1">#             &quot;free&quot;: 8192</span>
<span class="c1">#         }</span>
<span class="c1">#     }</span>
<span class="c1"># }</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">importlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.Plaza</span><span class="w"> </span><span class="kn">import</span> <span class="n">Plaza</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.Practice</span><span class="w"> </span><span class="kn">import</span> <span class="n">Practice</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.messages.UsePracticeMessage</span><span class="w"> </span><span class="kn">import</span> <span class="n">UsePracticeRequest</span><span class="p">,</span> <span class="n">UsePracticeResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.plazas.AgentPlaza</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentPlaza</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.plugs.gRPCPlug</span><span class="w"> </span><span class="kn">import</span> <span class="n">gRPCPlug</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.services.APIService</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIService</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.services.JobMarket</span><span class="w"> </span><span class="kn">import</span> <span class="n">JobMarket</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.LogEvent</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogEvent</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.Message</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.Plug</span><span class="w"> </span><span class="kn">import</span> <span class="n">Plug</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.Pit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.Pool</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.pools.DatabasePool</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabasePool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.AgentAddress</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentAddress</span>

<span class="c1"># Setup logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;prompits&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># Create console handler</span>
<span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># Create formatter</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

<span class="c1"># Add handler to logger</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

<div class="viewcode-block" id="AgentInfo">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.AgentInfo">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AgentInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the information about an agent.</span>
<span class="sd">    </span>
<span class="sd">    This class contains all the necessary metadata about an agent,</span>
<span class="sd">    including its name, description, identifier, environments,</span>
<span class="sd">    and associated components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">environments</span><span class="o">=</span><span class="p">{},</span> <span class="n">plugs</span><span class="o">=</span><span class="p">{},</span> <span class="n">pools</span><span class="o">=</span><span class="p">{},</span> <span class="n">plazas</span><span class="o">=</span><span class="p">{},</span> <span class="n">services</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize agent information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            agent_name: Name of the agent</span>
<span class="sd">            description: Description of the agent</span>
<span class="sd">            agent_id: Agent identifier (UUID will be generated if not provided)</span>
<span class="sd">            environments: Dictionary of environments the agent operates in</span>
<span class="sd">            plugs: Dictionary of communication plugs the agent has access to</span>
<span class="sd">            pools: Dictionary of data pools the agent has access to</span>
<span class="sd">            plazas: Dictionary of plazas the agent participates in</span>
<span class="sd">            services: Dictionary of services the agent provides or uses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_name</span> <span class="o">=</span> <span class="n">agent_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span> <span class="o">=</span> <span class="n">agent_id</span> <span class="k">if</span> <span class="n">agent_id</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="n">environments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span> <span class="o">=</span> <span class="n">plugs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pools</span> <span class="o">=</span> <span class="n">pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span> <span class="o">=</span> <span class="n">plazas</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">services</span> <span class="o">=</span> <span class="n">services</span>
        
<div class="viewcode-block" id="AgentInfo.ToJson">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.AgentInfo.ToJson">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ToJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert agent information to a JSON-serializable dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing all agent information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">plugs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plug</span><span class="p">,</span> <span class="n">Plug</span><span class="p">):</span>
                <span class="n">plugs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plug</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plugs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plug</span>
        <span class="n">pools</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">pool</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">Pool</span><span class="p">):</span>
                <span class="n">pools</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pools</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pool</span>
        <span class="n">plazas</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="n">Plaza</span><span class="p">):</span>
                <span class="n">plazas</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plaza</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plazas</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plaza</span>
        <span class="n">services</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">service</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">APIService</span><span class="p">):</span>
                <span class="n">services</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">services</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">service</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;plugs&quot;</span><span class="p">:</span> <span class="n">plugs</span><span class="p">,</span>
            <span class="s2">&quot;pools&quot;</span><span class="p">:</span> <span class="n">pools</span><span class="p">,</span>
            <span class="s2">&quot;plazas&quot;</span><span class="p">:</span> <span class="n">plazas</span><span class="p">,</span>
            <span class="s2">&quot;services&quot;</span><span class="p">:</span> <span class="n">services</span>
        <span class="p">}</span>
        <span class="c1"># practices are not determined in AgentInfo</span>
        <span class="n">practices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;agent_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_name</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
            <span class="s2">&quot;environments&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">,</span>
            <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="n">components</span>
        <span class="p">}</span></div>

    
<div class="viewcode-block" id="AgentInfo.FromJson">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.AgentInfo.FromJson">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">FromJson</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an AgentInfo object from a JSON dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            json_data: Dictionary containing agent information</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            AgentInfo: A new AgentInfo object initialized with data from the JSON</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">components</span><span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;components&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">agent_name</span><span class="o">=</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;agent_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Agent&quot;</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
            <span class="n">agent_id</span><span class="o">=</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;agent_id&quot;</span><span class="p">),</span>
            <span class="n">environments</span><span class="o">=</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environments&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="n">plugs</span><span class="o">=</span><span class="n">components</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plugs&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="n">pools</span><span class="o">=</span><span class="n">components</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pools&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="n">plazas</span><span class="o">=</span><span class="n">components</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plazas&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="n">services</span><span class="o">=</span><span class="n">components</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;services&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">)</span></div>
</div>

        
<div class="viewcode-block" id="Agent">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Agent</span><span class="p">(</span><span class="n">Pit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main agent class in the Prompits framework.</span>
<span class="sd">    </span>
<span class="sd">    An Agent is a specialized Pit that can instantiate multiple other Pits,</span>
<span class="sd">    communicate with other agents, and participate in plazas. It manages</span>
<span class="sd">    plugs for communication, pools for data storage, and plazas for agent</span>
<span class="sd">    discovery and collaboration.</span>
<span class="sd">    </span>
<span class="sd">    The Agent class is the central component that brings together all the </span>
<span class="sd">    pieces of the Prompits framework.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Agent&quot;</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize an Agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            name: Name of the agent</span>
<span class="sd">            description: Description of the agent</span>
<span class="sd">            agent_id: Optional ID for the agent, will generate a new UUID if not provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span> <span class="o">=</span> <span class="n">agent_id</span> <span class="k">if</span> <span class="n">agent_id</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;prompits.Agent.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Plug</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pools</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Pool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">services</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">APIService</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Plaza</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Plaza</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected_plazas</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Plaza</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_environments</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dictionary to store peer information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Thread for refreshing advertisements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Event to signal the refresh thread to stop</span>
        
        <span class="c1"># Add agent practices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="s2">&quot;ListPits&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ListPits</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="s2">&quot;StopAgent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">StopAgent</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="s2">&quot;RefreshPractice&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RefreshPractice</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="s2">&quot;SendMessage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendMessage</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="s2">&quot;ReceiveMessage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveMessage</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="s2">&quot;Advertise&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Advertise</span><span class="p">))</span>
        <span class="n">peer_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all pits associated with this agent.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with categories of pits (plugs, pools, plazas, services)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;plugs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="p">,</span>
            <span class="s2">&quot;pools&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="p">,</span>
            <span class="s2">&quot;plazas&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">,</span>
            <span class="s2">&quot;services&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">services</span>
        <span class="p">}</span>

<div class="viewcode-block" id="Agent.ListPits">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.ListPits">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ListPits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all pits associated with this agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            name_only: If True, returns only the names of the pits, otherwise returns the pit objects</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: A list of pit names or pit objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">name_only</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pit_type_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pit_type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pit_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pit_type_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pit_type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    
<div class="viewcode-block" id="Agent.create_component">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.create_component">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a component from a configuration.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            component_type: Type of component to create</span>
<span class="sd">            component_config: Configuration for the component</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            The created component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get component name and description</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">component_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">component_type</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">component_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create a copy of the config without name and description</span>
        <span class="n">config_copy</span> <span class="o">=</span> <span class="n">component_config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">config_copy</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;description&quot;</span> <span class="ow">in</span> <span class="n">config_copy</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">config_copy</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> and description </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        <span class="c1"># Handle special cases for component types</span>
        <span class="k">if</span> <span class="n">component_type</span> <span class="o">==</span> <span class="s2">&quot;PostgresPool&quot;</span><span class="p">:</span>
            <span class="c1"># PostgresPool requires connection_string as a positional argument</span>
            <span class="n">connection_string</span> <span class="o">=</span> <span class="n">config_copy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;connection_string&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;connection_string&quot;</span> <span class="ow">in</span> <span class="n">config_copy</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;connection_string&quot;</span><span class="p">]</span>
                
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.pools.PostgresPool</span><span class="w"> </span><span class="kn">import</span> <span class="n">PostgresPool</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">PostgresPool</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing PostgresPool: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
                
            <span class="c1"># Create the component</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">component</span> <span class="o">=</span> <span class="n">component_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">,</span> <span class="o">**</span><span class="n">config_copy</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">component</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span> <span class="o">==</span> <span class="s2">&quot;SQLitePool&quot;</span><span class="p">:</span>
            <span class="c1"># SQLitePool requires database_path as a positional argument</span>
            <span class="n">database_path</span> <span class="o">=</span> <span class="n">config_copy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;database_path&quot;</span><span class="p">,</span> <span class="n">config_copy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;connection_string&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;database_path&quot;</span> <span class="ow">in</span> <span class="n">config_copy</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;database_path&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;connection_string&quot;</span> <span class="ow">in</span> <span class="n">config_copy</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;connection_string&quot;</span><span class="p">]</span>
                
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.pools.SQLitePool</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLitePool</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">SQLitePool</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing SQLitePool: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
                
            <span class="c1"># Create the component</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;db_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">database_path</span>
                <span class="n">component</span> <span class="o">=</span> <span class="n">component_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">**</span><span class="n">config_copy</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">component</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span> <span class="o">==</span> <span class="s2">&quot;TCPPlug&quot;</span><span class="p">:</span>
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.plugs.TCPPlug</span><span class="w"> </span><span class="kn">import</span> <span class="n">TCPPlug</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">TCPPlug</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing TCPPlug: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
                
            <span class="c1"># Create the component</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">component</span> <span class="o">=</span> <span class="n">component_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">**</span><span class="n">config_copy</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">component</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span> <span class="o">==</span> <span class="s2">&quot;gRPCPlug&quot;</span><span class="p">:</span>
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.plugs.gRPCPlug</span><span class="w"> </span><span class="kn">import</span> <span class="n">gRPCPlug</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">gRPCPlug</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing gRPCPlug: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
                
            <span class="c1"># Create the component</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">component</span> <span class="o">=</span> <span class="n">component_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">**</span><span class="n">config_copy</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">component</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span> <span class="o">==</span> <span class="s2">&quot;AgentPlaza&quot;</span><span class="p">:</span>
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">.plazas.AgentPlaza</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentPlaza</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">AgentPlaza</span>
                <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;pool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="p">[</span><span class="n">component_config</span><span class="p">[</span><span class="s2">&quot;pool&quot;</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing AgentPlaza: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span><span class="o">==</span><span class="s2">&quot;Pathfinder&quot;</span><span class="p">:</span>
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.services.Pathfinder</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pathfinder</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">Pathfinder</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing Pathfinder: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span><span class="o">==</span><span class="s2">&quot;MCPClient&quot;</span><span class="p">:</span>
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.services.MCPClient</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPClient</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">MCPClient</span>
                <span class="n">components</span> <span class="o">=</span> <span class="p">{}</span> 
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_copy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mcp_server_params&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="n">description</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;MCP server </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">config_copy</span><span class="p">[</span><span class="s2">&quot;mcp_server_params&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">server_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mcp_server_params&quot;</span><span class="p">:</span><span class="n">value</span><span class="p">}</span>
                    <span class="c1">#print(f&quot;server_params: {server_params}&quot;)</span>
                    <span class="n">component</span> <span class="o">=</span> <span class="n">component_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">**</span><span class="n">server_params</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added MCP server </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> to MCPClient&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">component</span>
                    <span class="c1">#print(f&quot;MCPClient config: {config_copy}&quot;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCPClient config: </span><span class="si">{</span><span class="n">config_copy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                    <span class="n">components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">component</span>
                <span class="k">return</span> <span class="n">components</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing MCPClient: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span><span class="o">==</span><span class="s2">&quot;Ollama&quot;</span><span class="p">:</span>
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Importing Ollama&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.services.Ollama</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ollama</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">Ollama</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing Ollama: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">component_type</span><span class="o">==</span><span class="s2">&quot;JobMarket&quot;</span><span class="p">:</span>
            <span class="c1"># Import the component class</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Importing JobMarket&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.services.JobMarket</span><span class="w"> </span><span class="kn">import</span> <span class="n">JobMarket</span>
                <span class="n">component_class</span> <span class="o">=</span> <span class="n">JobMarket</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error importing JobMarket: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown component type: </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="c1"># Create the component</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="n">component_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">**</span><span class="n">config_copy</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">component</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2"> with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="c1"># create a class method to initialize an agent from an AgentInfo object and return an Agent object</span>
<div class="viewcode-block" id="Agent.FromJson">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.FromJson">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">FromJson</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">agent_info</span><span class="p">:</span> <span class="n">AgentInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize an agent from an AgentInfo object.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            agent_info: AgentInfo object containing agent information</span>

<span class="sd">        Returns:</span>
<span class="sd">            Agent: The initialized agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agent_info</span><span class="p">,</span> <span class="n">AgentInfo</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;agent_info must be an AgentInfo object&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating agent from AgentInfo: </span><span class="si">{</span><span class="n">agent_info</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Set agent name and description</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">agent_info</span><span class="o">.</span><span class="n">agent_name</span><span class="p">,</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        
        <span class="c1"># Override agent_id if specified</span>
        <span class="k">if</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">agent_id</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">agent_id</span> <span class="o">=</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">agent_id</span>
            
        <span class="c1"># Set environments</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">environments</span>
        
        <span class="c1"># Process plugs</span>
        <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># create the plug</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">plug_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">create_component</span><span class="p">(</span><span class="n">plug</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">plug</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added plug </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        <span class="c1"># Process pools</span>
        <span class="k">for</span> <span class="n">pool_name</span><span class="p">,</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">pools</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># create the pool</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">pools</span><span class="p">[</span><span class="n">pool_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">create_component</span><span class="p">(</span><span class="n">pool</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">pool</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added pool </span><span class="si">{</span><span class="n">pool_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        
        <span class="c1"># Process plazas</span>
        <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># create the plaza</span>
            <span class="c1">#print(f&quot;Creating plaza {plaza_name} with type {plaza[&#39;type&#39;]}&quot;)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> with type </span><span class="si">{</span><span class="n">plaza</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;plaza: </span><span class="si">{</span><span class="n">plaza</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">create_component</span><span class="p">(</span><span class="n">plaza</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">plaza</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;plaza created: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">],</span> <span class="n">AgentPlaza</span><span class="p">):</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;plaza pool: </span><span class="si">{</span><span class="n">plaza</span><span class="p">[</span><span class="s1">&#39;pool&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pools</span><span class="p">[</span><span class="n">plaza</span><span class="p">[</span><span class="s1">&#39;pool&#39;</span><span class="p">]]</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown plaza type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">plaza</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;plaza created: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Add plaza practices to the agent</span>
        <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Add plaza practices to the agent</span>
            <span class="k">for</span> <span class="n">practice_name</span><span class="p">,</span> <span class="n">practice_func</span> <span class="ow">in</span> <span class="n">plaza</span><span class="o">.</span><span class="n">practices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">plaza</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice_name</span><span class="p">]</span><span class="o">.</span><span class="n">function</span><span class="p">))</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added plaza practice </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        
        <span class="c1"># Process services</span>
        <span class="k">for</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># create the service</span>
            <span class="n">components</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">create_component</span><span class="p">(</span><span class="n">service</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">service</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">component</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added service </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">components</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added service </span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                
            <span class="c1"># If service is a JobMarket and has a pool_name, set the pool</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">JobMarket</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="s2">&quot;pool_name&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">service</span><span class="o">.</span><span class="n">pool_name</span><span class="p">:</span>
                <span class="n">pool_name</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">pool_name</span>
                <span class="k">if</span> <span class="n">pool_name</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">pools</span><span class="p">:</span>
                    <span class="n">service</span><span class="o">.</span><span class="n">set_pool</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">pools</span><span class="p">[</span><span class="n">pool_name</span><span class="p">])</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Set pool </span><span class="si">{</span><span class="n">pool_name</span><span class="si">}</span><span class="s2"> for service </span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Pool </span><span class="si">{</span><span class="n">pool_name</span><span class="si">}</span><span class="s2"> not found for service </span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
        
        
        <span class="c1"># Add pool practices to the agent</span>
        <span class="k">for</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">type_dict</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;adding practices type_name: </span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s1">&#39;practices&#39;</span><span class="p">):</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;adding practices pit_name: </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">practice_name</span><span class="p">,</span> <span class="n">practice_func</span> <span class="ow">in</span> <span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="c1"># Create a closure to capture the pit and practice_name</span>
                        <span class="c1"># function name is practices[practice_name].func</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice_name</span><span class="p">]</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">input_schema</span><span class="o">=</span><span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice_name</span><span class="p">]</span><span class="o">.</span><span class="n">input_schema</span><span class="p">,</span> <span class="n">is_async</span><span class="o">=</span><span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice_name</span><span class="p">]</span><span class="o">.</span><span class="n">is_async</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice_name</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added pool practice </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">agent</span></div>


<div class="viewcode-block" id="Agent.to_AgentInfo">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.to_AgentInfo">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_AgentInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert this agent to an AgentInfo object.</span>
<span class="sd">        </span>
<span class="sd">        This method creates an AgentInfo representation of the current agent</span>
<span class="sd">        that can be shared with other agents or serialized.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            AgentInfo: An AgentInfo object representing this agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AgentInfo</span><span class="p">(</span>
            <span class="n">agent_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">agent_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
            <span class="n">environments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">,</span>
            <span class="n">plugs</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">plug</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="n">pools</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">pool</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">pool</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="n">plazas</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">plaza</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;ToJson&#39;</span><span class="p">)},</span>
            <span class="n">services</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">service</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">service</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="s1">&#39;ToJson&#39;</span><span class="p">)}</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Agent.ToJson">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.ToJson">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ToJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert this agent to a JSON-serializable dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing all agent information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">agent_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_AgentInfo</span><span class="p">()</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;practices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">practice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">practices</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;practices&quot;</span><span class="p">][</span><span class="n">practice</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">practice</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="n">Pit</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">practice</span> <span class="ow">in</span> <span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;practices&quot;</span><span class="p">][</span><span class="n">pit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">practice</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">practice</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;practices&quot;</span> <span class="ow">in</span> <span class="n">pit</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">practice</span> <span class="ow">in</span> <span class="n">pit</span><span class="p">[</span><span class="s2">&quot;practices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;practices&quot;</span><span class="p">][</span><span class="n">pit</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">practice</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">practice</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json_data</span></div>

        
<div class="viewcode-block" id="Agent.request_use_practice">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.request_use_practice">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">request_use_practice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">practice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request to use a practice from another agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            to_agent: The agent to request the practice from</span>
<span class="sd">            practice: The practice to request</span>
<span class="sd">            **kwargs: Additional arguments for the practice</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the practice was requested successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># send a UsePracticeMessage to the other agent</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">UsePracticeMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">to_agent</span><span class="p">,</span> <span class="n">practice</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">[</span><span class="n">to_agent</span><span class="p">])</span></div>


<div class="viewcode-block" id="Agent.detect_environments">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.detect_environments">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">detect_environments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect environments from the host machine.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: Environment information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get CPU information</span>
        <span class="n">cpu_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cores&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="c1"># Get memory information</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
        <span class="n">memory_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
            <span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">available</span><span class="p">,</span>
            <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">percent</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">(),</span>
            <span class="s2">&quot;os_version&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">(),</span>
            <span class="s2">&quot;python_version&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">(),</span>
            <span class="s2">&quot;cpu&quot;</span><span class="p">:</span> <span class="n">cpu_info</span><span class="p">,</span>
            <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="n">memory_info</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="Agent.SendMessage">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.SendMessage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">SendMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AgentAddress</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a message to other agents.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            message: The message to send</span>
<span class="sd">            recipients: List of AgentAddress objects</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the message was sent successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending message to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">recipients</span><span class="p">)</span><span class="si">}</span><span class="s2"> recipients&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">recipient</span> <span class="o">=</span> <span class="n">AgentAddress</span><span class="p">(</span><span class="n">recipient</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">recipient</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">recipient_string</span> <span class="o">=</span> <span class="n">recipient</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">recipient_string</span> <span class="o">=</span> <span class="n">recipient</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;@&#39;</span><span class="o">+</span><span class="n">recipient</span><span class="p">[</span><span class="s1">&#39;plaza_name&#39;</span><span class="p">]</span>
                <span class="n">recipient</span> <span class="o">=</span> <span class="n">AgentAddress</span><span class="p">(</span><span class="n">recipient</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">],</span> <span class="n">recipient</span><span class="p">[</span><span class="s1">&#39;plaza_name&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">recipient_string</span> <span class="o">=</span> <span class="n">recipient</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing recipient: </span><span class="si">{</span><span class="n">recipient_string</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">recipient</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recipient </span><span class="si">{</span><span class="n">recipient</span><span class="si">}</span><span class="s2"> not in peer list, attempting to advertise&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Advertise</span><span class="p">(</span><span class="n">recipient</span><span class="o">.</span><span class="n">plaza_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">recipient</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recipient </span><span class="si">{</span><span class="n">recipient</span><span class="si">}</span><span class="s2"> not found in peer list after advertising&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recipient </span><span class="si">{</span><span class="n">recipient</span><span class="si">}</span><span class="s2"> not found in peer list&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">recipient</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">plugs_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">[</span><span class="n">recipient</span><span class="o">.</span><span class="n">to_string</span><span class="p">()][</span><span class="s1">&#39;agent_info&#39;</span><span class="p">][</span><span class="s1">&#39;components&#39;</span><span class="p">][</span><span class="s1">&#39;plugs&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">plug_info</span> <span class="ow">in</span> <span class="n">plugs_info</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">plugs_info</span><span class="p">[</span><span class="n">plug_info</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">plugs_info</span><span class="p">[</span><span class="n">plug_info</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gRPCPlug&#39;</span><span class="p">:</span>
                            <span class="n">address</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">plugs_info</span><span class="p">[</span><span class="n">plug_info</span><span class="p">][</span><span class="s1">&#39;host&#39;</span><span class="p">],</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">plugs_info</span><span class="p">[</span><span class="n">plug_info</span><span class="p">][</span><span class="s1">&#39;port&#39;</span><span class="p">]}</span>
                            <span class="n">plug</span> <span class="o">=</span> <span class="n">gRPCPlug</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">],</span> <span class="n">address</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending via gRPCPlug to </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending via gRPCPlug to </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">plug</span><span class="o">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
                                <span class="k">return</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported plug type: </span><span class="si">{</span><span class="n">plugs_info</span><span class="p">[</span><span class="n">plug_info</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported plug type: </span><span class="si">{</span><span class="n">plugs_info</span><span class="p">[</span><span class="n">plug_info</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No plug type specified in plug info&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No plug type: </span><span class="si">{</span><span class="n">plug_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recipient </span><span class="si">{</span><span class="n">recipient</span><span class="si">}</span><span class="s2"> not found in peer list&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recipient </span><span class="si">{</span><span class="n">recipient</span><span class="si">}</span><span class="s2"> not found in peer list&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Agent.ReceiveMessage">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.ReceiveMessage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ReceiveMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receive a message from another agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg_count: int, number of messages to receive. 0 means all messages.</span>
<span class="sd">        Returns:</span>
<span class="sd">            list[Message]: list of messages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receiving messages (count: </span><span class="si">{</span><span class="n">msg_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="c1">#print(f&quot;Receiving messages (count: {msg_count})&quot;)</span>
        <span class="n">msg_list</span><span class="p">:[</span><span class="n">Message</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">plug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">plug</span><span class="o">.</span><span class="n">UsePractice</span><span class="p">(</span><span class="s2">&quot;ReceiveMessage&quot;</span><span class="p">,</span> <span class="n">msg_count</span><span class="p">)</span>
                <span class="n">msg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="c1">#print(f&quot;\n\n**** Message: {message}\n\n&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received message </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2"> from plug </span><span class="si">{</span><span class="n">plug</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1">#print(f&quot;Error receiving messages from plug {plug.name}: {str(e)}&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error receiving messages from plug </span><span class="si">{</span><span class="n">plug</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">msg_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> messages&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msg_list</span></div>

        

<div class="viewcode-block" id="Agent.remove_pit">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.remove_pit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_pit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pit_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a pit from the agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pit_name: Name of the pit</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the pit was removed successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if pit_name is in self.plugs, self.pools, self.plazas, self.services</span>
        <span class="k">if</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">services</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2"> from agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.get_pit">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.get_pit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_pit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pit_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a pit by name.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pit_name: Name of the pit</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            object: The pit, or None if not found   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if pit_name is in self.plugs, self.pools, self.plazas, self.services</span>
        <span class="k">if</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pools</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">services</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">services</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Agent.create_plaza">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.create_plaza">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_plaza</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plaza</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            plaza: plaza to create</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if created successfully</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plaza</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plaza</span>
        
        <span class="c1"># Set the agent reference in the plaza</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;agent&#39;</span><span class="p">):</span>
            <span class="n">plaza</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span>
        
        <span class="c1"># Start the plaza</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">):</span>
            <span class="n">plaza</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.remove_plaza">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.remove_plaza">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_plaza</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove an owned plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if removed successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> is not owned by this agent&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Stop the plaza if it&#39;s running</span>
        <span class="n">plaza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">):</span>
            <span class="n">plaza</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        
        <span class="c1"># Remove from both owned and all plazas</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.connect_to_plaza">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.connect_to_plaza">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">connect_to_plaza</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plaza</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            plaza: plaza object</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if connected successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_plazas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Already connected to plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Set the agent reference in the plaza if it supports it</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;agent&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">plaza</span><span class="o">.</span><span class="n">agent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plaza</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span>
        
        <span class="c1"># Connect to the plaza</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected_plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plaza</span>
        
        <span class="c1"># Advertise on the plaza</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Advertise</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error advertising on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.disconnect_from_plaza">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.disconnect_from_plaza">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">disconnect_from_plaza</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnect from a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if disconnected successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Cannot disconnect from owned plazas this way</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot disconnect from owned plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">. Use remove_plaza instead.&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
            
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_plazas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not connected to plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Stop advertisement thread if running</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_advertisement_refresh</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
        
        <span class="c1"># Remove from both connected and all plazas</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Disconnected from plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.get_plaza">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.get_plaza">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_plaza</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a plaza by name.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            object: The plaza, or None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="Agent.is_plaza_owner">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.is_plaza_owner">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_plaza_owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the agent owns a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the agent owns the plaza, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span></div>


<div class="viewcode-block" id="Agent.Advertise">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.Advertise">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Advertise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Advertise the agent on a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if advertised successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if the plaza is connected</span>
            <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="n">plaza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
            
            <span class="c1"># Check if the plaza supports the Advertise practice</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;Advertise&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> does not support advertising&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Get the agent info</span>
            <span class="n">agent_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ToJson</span><span class="p">()</span>
            
            <span class="c1"># Advertise the agent on the plaza</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">plaza</span><span class="o">.</span><span class="n">Advertise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">agent_info</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advertised agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advertised agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

            <span class="c1"># load peer list from plaza</span>
            <span class="n">active_agents</span> <span class="o">=</span> <span class="n">plaza</span><span class="o">.</span><span class="n">UsePractice</span><span class="p">(</span><span class="s1">&#39;ListActiveAgents&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">active_agents</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">[</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;agent_id&#39;</span><span class="p">]</span><span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">plaza_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">[</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;agent_name&#39;</span><span class="p">]</span><span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">plaza_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error advertising agent: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Agent.start_advertisement_refresh">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.start_advertisement_refresh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_advertisement_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start refreshing advertisements on a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            interval: Refresh interval in seconds</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if started successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not connected to plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Check if already running</span>
            <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advertisement refresh already running for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Create a stop event</span>
            <span class="n">stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
            
            <span class="c1"># Create and start the thread</span>
            <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_advertisements</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            
            <span class="c1"># Store thread info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;thread&quot;</span><span class="p">:</span> <span class="n">thread</span><span class="p">,</span>
                <span class="s2">&quot;stop_event&quot;</span><span class="p">:</span> <span class="n">stop_event</span><span class="p">,</span>
                <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="n">interval</span>
            <span class="p">}</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started advertisement refresh for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> (interval: </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2"> seconds)&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error starting advertisement refresh: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Agent.stop_advertisement_refresh">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.stop_advertisement_refresh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop_advertisement_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop refreshing advertisements on a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if stopped successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if running</span>
            <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advertisement refresh not running for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Get thread info</span>
            <span class="n">thread_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
            
            <span class="c1"># Signal the thread to stop</span>
            <span class="n">thread_info</span><span class="p">[</span><span class="s2">&quot;stop_event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            
            <span class="c1"># Remove from the dictionary</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped advertisement refresh for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error stopping advertisement refresh: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_advertisements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh advertisements on a plaza periodically.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            interval: Refresh interval in seconds</span>
<span class="sd">            stop_event: Event to signal when to stop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Refresh advertisement</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Advertise</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error refreshing advertisement on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                
                <span class="c1"># Wait for the next refresh or until stopped</span>
                <span class="n">stop_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in advertisement refresh thread: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

<div class="viewcode-block" id="Agent.search_advertisements">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.search_advertisements">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">search_advertisements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for advertisements on a plaza.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza</span>
<span class="sd">            query: Search criteria</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            List[Dict]: List of advertisements matching the criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not connected to plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
            
            <span class="n">plaza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
            
            <span class="c1"># Check if the plaza has the search_advertisements practice</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s2">&quot;search_advertisements&quot;</span><span class="p">):</span>
                <span class="c1"># Search for advertisements</span>
                <span class="n">advertisements</span> <span class="o">=</span> <span class="n">plaza</span><span class="o">.</span><span class="n">search_advertisements</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">advertisements</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> does not support search_advertisements practice&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error searching advertisements on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Agent.start">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.start">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            auto_refresh: Whether to automatically start refreshing advertisements</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if started successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent is already running&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Starting agent&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        
        <span class="c1"># Start all plugs</span>
        <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plug</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plug</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started plug </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error starting plug </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="c1"># Start all plazas</span>
        <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">owned_plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plaza</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error starting plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="c1"># Advertise on all plazas</span>
        <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Advertise</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advertised on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error advertising on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="c1"># Start automatic advertisement refresh if requested</span>
        <span class="k">if</span> <span class="n">auto_refresh</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RefreshPractice</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Started automatic advertisement refresh&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error starting advertisement refresh: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Agent started successfully&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.stop">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.stop">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the agent and all its components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Agent is not running&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Stopping agent&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
        
        <span class="c1"># Stop the refresh thread if it exists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Stopping refresh thread&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># Update stop time for all plazas</span>
        <span class="k">for</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span><span class="o">.</span><span class="n">update_agent_stop_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated stop time for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating stop time for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="c1"># Stop all advertisement refresh threads</span>
        <span class="k">for</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_advertisement_refresh</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped advertisement refresh for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error stopping advertisement refresh for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="c1"># Stop all pits</span>
        <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pit_type_dict</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pit_type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">pit</span><span class="o">.</span><span class="n">stop</span><span class="p">):</span>
                        <span class="n">pit</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error stopping pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Agent stopped&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Agent.action">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.action">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform agent actions.</span>
<span class="sd">        </span>
<span class="sd">        This method is called in a loop to allow the agent to perform actions.</span>
<span class="sd">        It processes messages from plugs, handles requests, and performs other tasks.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if actions were performed, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not running&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
            
        <span class="c1"># Process messages from plugs</span>
        <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s2">&quot;receive&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">pit</span><span class="o">.</span><span class="n">receive</span><span class="p">):</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">pit</span><span class="o">.</span><span class="n">receive</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received message on pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                    <span class="c1"># Process the message based on its type</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="k">if</span> <span class="s2">&quot;request&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                            <span class="c1"># Handle practice request</span>
                            <span class="n">request</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">]</span>
                            <span class="n">practice</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;practice&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">practice</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">handle_practice_request</span><span class="p">(</span><span class="n">pit_name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        
        <span class="c1"># Check for expired advertisements</span>
        <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s2">&quot;clean_expired_advertisements&quot;</span><span class="p">):</span>
                <span class="n">plaza</span><span class="o">.</span><span class="n">clean_expired_advertisements</span><span class="p">()</span>
                
        <span class="c1"># Update environment information periodically</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Update roughly every minute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_environments</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="kc">True</span></div>

        
<div class="viewcode-block" id="Agent.handle_practice_request">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.handle_practice_request">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_practice_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span><span class="n">UsePracticeRequest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle a practice request.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            message: Message containing the request</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if handled successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">]</span>
        <span class="n">practice</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;practice&quot;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">sender_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sender_id&quot;</span><span class="p">)</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">)</span>
        <span class="n">plaza_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plaza_name&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add or update peer information</span>
        <span class="k">if</span> <span class="n">sender_id</span> <span class="ow">and</span> <span class="n">plaza_name</span><span class="p">:</span>
            <span class="n">peer_address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">AgentAddress</span><span class="p">(</span><span class="n">sender_id</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">))</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">peer_address</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">[</span><span class="n">peer_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="n">sender_id</span><span class="p">,</span>
                    <span class="s2">&quot;plaza_name&quot;</span><span class="p">:</span> <span class="n">plaza_name</span><span class="p">,</span>
                    <span class="s2">&quot;first_seen&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
                    <span class="s2">&quot;last_seen&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
                    <span class="s2">&quot;practices&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                    <span class="s2">&quot;connection_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;pit_name&quot;</span><span class="p">:</span> <span class="n">pit_name</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New peer connected: </span><span class="si">{</span><span class="n">peer_address</span><span class="si">}</span><span class="s2"> through </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">[</span><span class="n">peer_address</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s2">&quot;last_seen&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
                    <span class="s2">&quot;connection_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">[</span><span class="n">peer_address</span><span class="p">][</span><span class="s2">&quot;connection_count&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;pit_name&quot;</span><span class="p">:</span> <span class="n">pit_name</span>
                <span class="p">})</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Existing peer reconnected: </span><span class="si">{</span><span class="n">peer_address</span><span class="si">}</span><span class="s2"> through </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            
            <span class="c1"># Add the practice to peer&#39;s known practices</span>
            <span class="k">if</span> <span class="n">practice</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peer_list</span><span class="p">[</span><span class="n">peer_address</span><span class="p">][</span><span class="s2">&quot;practices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">practice</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Handling practice request: </span><span class="si">{</span><span class="n">practice</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">sender_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        
        <span class="c1"># Find the pit with the practice</span>
        <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pit_type_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pit_type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s2">&quot;HasPractice&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pit</span><span class="o">.</span><span class="n">HasPractice</span><span class="p">(</span><span class="n">practice</span><span class="p">):</span>
                    <span class="c1"># Execute the practice</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">pit</span><span class="o">.</span><span class="n">UsePractice</span><span class="p">(</span><span class="n">practice</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
                        
                        <span class="c1"># Send response is UsePracticeResponse</span>
                        
                        <span class="n">response</span> <span class="o">=</span> <span class="n">UsePracticeResponse</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">request_id</span><span class="p">)</span>
                        
                        <span class="c1"># Get the pit that received the request</span>
                        <span class="n">source_pit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pit_name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">source_pit</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source_pit</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">):</span>
                            <span class="n">source_pit</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                            
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="c1"># Send error response</span>
                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                                <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request_id</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;sender_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
                            <span class="s2">&quot;receiver_id&quot;</span><span class="p">:</span> <span class="n">sender_id</span>
                        <span class="p">}</span>
                        
                        <span class="c1"># Get the pit that received the request</span>
                        <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pit_type_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pit_type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">pit_name</span> <span class="o">==</span> <span class="n">pit_name</span><span class="p">:</span>
                                    <span class="n">source_pit</span> <span class="o">=</span> <span class="n">pit</span>
                                    <span class="k">break</span>
                        <span class="k">if</span> <span class="n">source_pit</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source_pit</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">):</span>
                            <span class="n">source_pit</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                            
                        <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># practice not found</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;practice </span><span class="si">{</span><span class="n">practice</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">,</span>
                <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="n">request_id</span>
            <span class="p">},</span>
            <span class="s2">&quot;sender_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
            <span class="s2">&quot;receiver_id&quot;</span><span class="p">:</span> <span class="n">sender_id</span>
        <span class="p">}</span>
        
        <span class="c1"># Get the pit that received the request</span>
        <span class="n">source_pit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pit_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source_pit</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source_pit</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">):</span>
            <span class="n">source_pit</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Agent.add_plaza">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.add_plaza">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_plaza</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a plaza to the agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_type: Type of plaza to add</span>
<span class="sd">            name: Name of the plaza</span>
<span class="sd">            description: Description of the plaza</span>
<span class="sd">            **kwargs: Additional arguments to pass to the plaza constructor</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The created plaza</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Import the plaza class dynamically</span>
            <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">plaza_type</span><span class="p">:</span>
                <span class="n">module_name</span><span class="p">,</span> <span class="n">class_name</span> <span class="o">=</span> <span class="n">plaza_type</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Default to prompits.plazas package</span>
                <span class="n">module_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;prompits.plazas.</span><span class="si">{</span><span class="n">plaza_type</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">class_name</span> <span class="o">=</span> <span class="n">plaza_type</span>
            
            <span class="c1"># Try to import the module</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="c1"># If not found in prompits.plazas, try direct import</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">plaza_type</span><span class="p">)</span>
                <span class="n">class_name</span> <span class="o">=</span> <span class="n">plaza_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># Get the class</span>
            <span class="n">plaza_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
            
            <span class="c1"># Create an instance of the plaza</span>
            <span class="n">plaza</span> <span class="o">=</span> <span class="n">plaza_class</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="c1"># Add the plaza to the agent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plaza</span>
            
            <span class="c1"># Add the plaza&#39;s practices to the agent</span>
            <span class="k">for</span> <span class="n">practice_name</span><span class="p">,</span> <span class="n">practice_func</span> <span class="ow">in</span> <span class="n">plaza</span><span class="o">.</span><span class="n">practices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="n">Practice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">practice_func</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added plaza practice </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            
            <span class="c1"># Start the plaza</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">):</span>
                <span class="n">plaza</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            
            <span class="k">return</span> <span class="n">plaza</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding plaza: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Agent.set_message_handler">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.set_message_handler">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_message_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a message handler function for the agent.</span>
<span class="sd">        </span>
<span class="sd">        The handler function should accept two arguments:</span>
<span class="sd">        - message: The received message</span>
<span class="sd">        - agent: The agent instance</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            handler: The handler function</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if set successfully</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_handler</span> <span class="o">=</span> <span class="n">handler</span>
        
        <span class="c1"># Set the handler for all plugs</span>
        <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plug</span><span class="p">,</span> <span class="s2">&quot;set_message_handler&quot;</span><span class="p">):</span>
                <span class="n">plug</span><span class="o">.</span><span class="n">set_message_handler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="n">handler</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.ConnectAgent">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.ConnectAgent">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ConnectAgent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_address</span><span class="p">:</span> <span class="n">AgentAddress</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to an agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if the agent is already connected</span>
        <span class="k">if</span> <span class="n">agent_address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_agents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Already connected to agent </span><span class="si">{</span><span class="n">agent_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># connect to the agent</span>
        <span class="c1"># get agent&#39;s info from the agent address</span>
        <span class="n">agent_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_agent_info</span><span class="p">(</span><span class="n">agent_address</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agent_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get agent info for </span><span class="si">{</span><span class="n">agent_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># connect to the agent</span>
        <span class="c1"># check all plugs of the agent</span>
        <span class="c1"># for all plugs of the agent, check if the plug is connectable</span>
        <span class="k">if</span> <span class="n">plug_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plug_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plugs&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plug </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2"> not found in agent </span><span class="si">{</span><span class="n">agent_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">plug</span> <span class="o">=</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plugs&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;connectable&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plug </span><span class="si">{</span><span class="n">plug_name</span><span class="si">}</span><span class="s2"> is not connectable&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span></div>

            


<div class="viewcode-block" id="Agent.get_agent_info">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.get_agent_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_agent_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_address</span><span class="p">:</span> <span class="n">AgentAddress</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get agent info from the agent address.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get agent&#39;s info from plaza</span>
        <span class="n">plaza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">agent_address</span><span class="o">.</span><span class="n">plaza_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plaza</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not connected to plaza </span><span class="si">{</span><span class="n">agent_address</span><span class="o">.</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">return</span> <span class="n">plaza</span><span class="o">.</span><span class="n">UsePractice</span><span class="p">(</span><span class="s2">&quot;GetAgentInfo&quot;</span><span class="p">,</span> <span class="n">agent_address</span><span class="p">)</span></div>


<div class="viewcode-block" id="Agent.update_agent_stop_time1">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.update_agent_stop_time1">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_agent_stop_time1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the stop_time field in the agents table when the agent stops.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plaza_name: Name of the plaza with a DatabasePool</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if updated successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plaza_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not connected to plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="n">plaza</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="p">[</span><span class="n">plaza_name</span><span class="p">]</span>
        
        <span class="c1"># Find a DatabasePool in the plaza</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;pools&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> has no pools&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="n">db_pool</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">plaza</span><span class="o">.</span><span class="n">pools</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">DatabasePool</span><span class="p">):</span>
                <span class="n">db_pool</span> <span class="o">=</span> <span class="n">pool</span>
                <span class="k">break</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">db_pool</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No DatabasePool found in plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Current time</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Don&#39;t have to Make sure we have a fresh connection</span>
            <span class="c1"># just make sure the connection is open</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">db_pool</span><span class="o">.</span><span class="n">_IsConnected</span><span class="p">():</span>
                <span class="n">db_pool</span><span class="o">.</span><span class="n">_Connect</span><span class="p">()</span>
            
            <span class="c1"># Check if the agent exists</span>
            <span class="n">existing_agents</span> <span class="o">=</span> <span class="n">db_pool</span><span class="o">.</span><span class="n">UsePractice</span><span class="p">(</span><span class="s2">&quot;GetTableData&quot;</span><span class="p">,</span> <span class="s1">&#39;agents&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">})</span>
            
            <span class="k">if</span> <span class="n">existing_agents</span><span class="p">:</span>
                <span class="c1"># Update existing agent</span>
                <span class="n">db_pool</span><span class="o">.</span><span class="n">UsePractice</span><span class="p">(</span><span class="s2">&quot;Update&quot;</span><span class="p">,</span>
                    <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;agents&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;stop_time&quot;</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;inactive&quot;</span>
                    <span class="p">},</span>
                    <span class="n">where_clause</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">},</span>
                    <span class="n">table_schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_table_schema</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated agent stop time for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">db_pool</span><span class="p">,</span> <span class="s1">&#39;Commit&#39;</span><span class="p">):</span>
                    <span class="n">db_pool</span><span class="o">.</span><span class="n">Commit</span><span class="p">()</span>
                
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found in &#39;agents&#39; table&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">db_pool</span><span class="p">,</span> <span class="s1">&#39;Rollback&#39;</span><span class="p">):</span>
                <span class="n">db_pool</span><span class="o">.</span><span class="n">Rollback</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating agent stop time: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Agent.StopAgent">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.StopAgent">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">StopAgent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the agent.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Status message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Stop all advertisement refresh threads</span>
            <span class="k">for</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopping advertisement refresh for plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_advertisement_refresh</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
            
            <span class="c1"># Stop the main refresh thread if running</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="c1"># Update stop time on all plazas</span>
            <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s2">&quot;update_agent_stop_time&quot;</span><span class="p">):</span>
                    <span class="n">plaza</span><span class="o">.</span><span class="n">update_agent_stop_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">)</span>
            
            <span class="c1"># Stop all plazas</span>
            <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">):</span>
                    <span class="n">plaza</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            
            <span class="c1"># Stop all plugs</span>
            <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plug</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">):</span>
                    <span class="n">plug</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            
            <span class="c1"># Stop all pits</span>
            <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pit_type_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pit_type_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">):</span>
                        <span class="n">pit</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> stopped&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error stopping agent: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error stopping agent: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>

        
<div class="viewcode-block" id="Agent.RefreshPractice">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.RefreshPractice">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">RefreshPractice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh agent advertisements on all connected plazas.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            duration: Duration in seconds to refresh advertisements (0 for indefinite)</span>
<span class="sd">            interval: Refresh interval in seconds</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Status message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Find all plazas to advertise on</span>
            <span class="n">plazas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plazas</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has no plazas to advertise on&quot;</span>
            
            <span class="c1"># Stop any existing refresh threads</span>
            <span class="k">for</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">advertisement_threads</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_advertisement_refresh</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
            
            <span class="c1"># Create a stop event for the refresh thread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
            
            <span class="c1"># Create and start the refresh thread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_all_advertisements</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">plazas</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stop_event</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Started advertisement refresh for </span><span class="si">{</span><span class="s1">&#39;indefinite time&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">duration</span><span class="si">}</span><span class="s2"> seconds with </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2"> second intervals on plazas: </span><span class="si">{</span><span class="n">plazas</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error starting advertisement refresh: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error starting advertisement refresh: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_all_advertisements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plazas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh advertisements on all plazas periodically.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plazas: List of plaza names</span>
<span class="sd">            interval: Refresh interval in seconds</span>
<span class="sd">            duration: Duration in seconds (0 for indefinite)</span>
<span class="sd">            stop_event: Event to signal when to stop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            
            <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="c1"># Check if duration has elapsed</span>
                <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">duration</span><span class="p">:</span>
                    <span class="k">break</span>
                
                <span class="c1"># Refresh advertisements on all plazas</span>
                <span class="k">for</span> <span class="n">plaza_name</span> <span class="ow">in</span> <span class="n">plazas</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Advertise</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error refreshing advertisement on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                
                <span class="c1"># Wait for the next refresh or until stopped</span>
                <span class="n">stop_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in refresh all advertisements thread: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

<div class="viewcode-block" id="Agent.AddPractice">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.AddPractice">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddPractice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">practice</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a practice to the agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            practice: Practice object or name of the practice</span>
<span class="sd">            func: Function to call when the practice is used (if practice is a name)</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if added successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If a function is provided, create a Practice object</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">prompits.Practice</span><span class="w"> </span><span class="kn">import</span> <span class="n">Practice</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice</span><span class="p">]</span> <span class="o">=</span> <span class="n">Practice</span><span class="p">(</span><span class="n">practice</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If a Practice object is provided, add it directly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">practice</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.add_plug">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.add_plug">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_plug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plug</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a plug to the agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            plug: Plug to add</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if added successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">plug</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plug</span>
        
        <span class="c1"># Set the agent reference in the plug if it has a set_agent method</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plug</span><span class="p">,</span> <span class="s1">&#39;set_agent&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">plug</span><span class="o">.</span><span class="n">set_agent</span><span class="p">):</span>
            <span class="n">plug</span><span class="o">.</span><span class="n">set_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
        <span class="c1"># Add the plug&#39;s practices to the agent</span>
        <span class="k">for</span> <span class="n">practice_name</span><span class="p">,</span> <span class="n">practice_func</span> <span class="ow">in</span> <span class="n">plug</span><span class="o">.</span><span class="n">practices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddPractice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plug</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">practice_func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added pool practice </span><span class="si">{</span><span class="n">plug</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Agent.subscribe_to_component_logs">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.subscribe_to_component_logs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">subscribe_to_component_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">LogEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subscribe to log events from all components.&quot;&quot;&quot;</span>
        <span class="c1">#print(f&quot;\n&gt;&gt;&gt; AGENT.subscribe_to_component_logs starting for agent {self.name}&quot;)</span>
        
        <span class="c1"># Subscribe to agent&#39;s own logs</span>
        <span class="c1">#print(f&quot;&gt;&gt;&gt; Subscribing agent {self.name} to logs&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe_to_logs</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        
        <span class="c1"># Subscribe to all components&#39; logs</span>
        <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1">#print(f&quot;&gt;&gt;&gt; Processing pit_type: {pit_type}, pits count: {len(pits)}&quot;)</span>
            <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1">#print(f&quot;&gt;&gt;&gt; Checking pit: {pit_name} of type {type(pit).__name__}&quot;)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s1">&#39;subscribe_to_logs&#39;</span><span class="p">):</span>
                    <span class="c1"># Direct execution check</span>
                    <span class="c1">#print(f&quot;&gt;&gt;&gt; DIRECT: Subscribing to logs for {pit_type} {pit_name}, callback: {callback}&quot;)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Check if this pit already has this subscriber</span>
                        <span class="c1">#if hasattr(pit, &#39;log_subscribers&#39;) and callback in pit.log_subscribers:</span>
                            <span class="c1">#print(f&quot;&gt;&gt;&gt; NOTICE: {pit_name} already has this callback registered&quot;)</span>
                        
                        <span class="c1"># Subscribe anyway</span>
                        <span class="n">pit</span><span class="o">.</span><span class="n">subscribe_to_logs</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
                        <span class="c1">#print(f&quot;&gt;&gt;&gt; SUCCESS: Subscribed to logs for {pit_type} {pit_name}&quot;)</span>
                        
                        <span class="c1"># Verify subscription worked</span>
                        <span class="c1"># if hasattr(pit, &#39;log_subscribers&#39;) and callback in pit.log_subscribers:</span>
                        <span class="c1">#     #print(f&quot;&gt;&gt;&gt; VERIFIED: Callback successfully added to {pit_name}&#39;s subscribers.&quot;)</span>
                        <span class="c1">#     #print(f&quot;&gt;&gt;&gt; {pit_name} now has {len(pit.log_subscribers)} subscribers&quot;)</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     #print(f&quot;&gt;&gt;&gt; WARNING: Callback NOT found in {pit_name}&#39;s subscribers after addition!&quot;)</span>
                            
                        <span class="c1">#self.log(f&quot;Subscribed to log events for {pit_type} {pit_name}&quot;, &#39;DEBUG&#39;)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;&gt;&gt; ERROR subscribing to logs for </span><span class="si">{</span><span class="n">pit_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;&gt;&gt; SKIP: </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2"> does not have subscribe_to_logs method&quot;</span><span class="p">)</span>
                    
        <span class="c1"># Extra check for plazas which are a critical case</span>
        <span class="k">for</span> <span class="n">plaza_name</span><span class="p">,</span> <span class="n">plaza</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plazas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1">#print(f&quot;&gt;&gt;&gt; Direct plaza check: {plaza_name}&quot;)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plaza</span><span class="p">,</span> <span class="s1">&#39;log_subscribers&#39;</span><span class="p">):</span>
                <span class="c1">#print(f&quot;&gt;&gt;&gt; Plaza {plaza_name} has {len(plaza.log_subscribers)} subscribers&quot;)</span>
                
                <span class="c1"># Test log generation</span>
                <span class="c1">#plaza.log(f&quot;SUBSCRIPTION TEST from Agent.subscribe_to_component_logs for plaza {plaza_name}&quot;, &#39;DEBUG&#39;)</span>
                
                <span class="c1"># Extra force-add if needed</span>
                <span class="k">if</span> <span class="n">callback</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plaza</span><span class="o">.</span><span class="n">log_subscribers</span><span class="p">:</span>
                    <span class="c1">#print(f&quot;&gt;&gt;&gt; NOTICE: Callback not in plaza {plaza_name}&#39;s subscribers - adding it directly&quot;)</span>
                    <span class="n">plaza</span><span class="o">.</span><span class="n">log_subscribers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
                    <span class="c1">#print(f&quot;&gt;&gt;&gt; After direct add, plaza has {len(plaza.log_subscribers)} subscribers&quot;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;&gt;&gt; WARNING: Plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> does not have log_subscribers attribute!&quot;</span><span class="p">)</span>
                
        <span class="c1">#print(f&quot;&gt;&gt;&gt; AGENT.subscribe_to_component_logs completed for agent {self.name}&quot;)</span>
        
        <span class="c1"># Return a test message to show it worked</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Subscribed to logs for agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="p">)</span><span class="si">}</span><span class="s2"> components&quot;</span></div>


<div class="viewcode-block" id="Agent.unsubscribe_from_component_logs">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.unsubscribe_from_component_logs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">unsubscribe_from_component_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">LogEvent</span><span class="p">],</span> <span class="kc">None</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unsubscribe from log events from all components.&quot;&quot;&quot;</span>
        <span class="c1"># Unsubscribe from agent&#39;s own logs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unsubscribe_from_logs</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        
        <span class="c1"># Unsubscribe from all components&#39; logs</span>
        <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pit_name</span><span class="p">,</span> <span class="n">pit</span> <span class="ow">in</span> <span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s1">&#39;unsubscribe_from_logs&#39;</span><span class="p">):</span>
                    <span class="n">pit</span><span class="o">.</span><span class="n">unsubscribe_from_logs</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span></div>

                    <span class="c1">#self.log(f&quot;Unsubscribed from log events for {pit_type} {pit_name}&quot;, &#39;DEBUG&#39;)</span>

<div class="viewcode-block" id="Agent.add_component">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.add_component">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a component to the agent.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            component_type: Type of component (e.g., &#39;pools&#39;, &#39;plugs&#39;, &#39;plazas&#39;, &#39;pathfinders&#39;)</span>
<span class="sd">            component_name: Name of the component</span>
<span class="sd">            component: The component object to add</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if added successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create the component dictionary if it doesn&#39;t exist</span>
            <span class="k">if</span> <span class="n">component_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="p">[</span><span class="n">component_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="c1"># Add the component</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="p">[</span><span class="n">component_type</span><span class="p">][</span><span class="n">component_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">component</span>
            
            <span class="c1"># Subscribe to component logs</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="s1">&#39;subscribe_to_logs&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">subscriber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_subscribers</span><span class="p">:</span>
                    <span class="n">component</span><span class="o">.</span><span class="n">subscribe_to_logs</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">component_name</span><span class="si">}</span><span class="s2"> to agent </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding component </span><span class="si">{</span><span class="n">component_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">component_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Agent.UsePracticeRemote">
<a class="viewcode-back" href="../../prompits.Agent.html#prompits.Agent.Agent.UsePracticeRemote">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">UsePracticeRemote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">practice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agent_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">practice_input</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use a practice from a remote agent.</span>
<span class="sd">        </span>
<span class="sd">        This method allows an agent to call a practice on another agent, either local or remote.</span>
<span class="sd">        It handles the communication details, including message formatting, sending, and response handling.</span>
<span class="sd">        </span>
<span class="sd">        The method supports three modes of operation:</span>
<span class="sd">        1. Local practice calls (when agent_id matches self.agent_id)</span>
<span class="sd">        2. Testing mode with simulated responses (when self.testing_mode is True)</span>
<span class="sd">        3. Production mode with actual remote calls (default when not in testing mode)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            practice: The practice to use, can be in the format &quot;pit_name/practice_name&quot; or just &quot;practice_name&quot;</span>
<span class="sd">            agent_address: The address of the agent to call in the format &quot;agent_id@plaza_name&quot;</span>
<span class="sd">            practice_input: Dictionary containing input parameters for the practice</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the result of the practice or error information</span>
<span class="sd">                Success case: {&quot;result&quot;: &lt;result_value&gt;, ...}</span>
<span class="sd">                Error case: {&quot;error&quot;: &lt;error_message&gt;}</span>
<span class="sd">                </span>
<span class="sd">        Raises:</span>
<span class="sd">            No exceptions are raised; errors are returned in the result dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using remote practice </span><span class="si">{</span><span class="n">practice</span><span class="si">}</span><span class="s2"> on agent </span><span class="si">{</span><span class="n">agent_address</span><span class="si">}</span><span class="s2"> with input </span><span class="si">{</span><span class="n">practice_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
        
        <span class="c1"># Parse agent address</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">agent_id</span><span class="p">,</span> <span class="n">plaza_name</span> <span class="o">=</span> <span class="n">agent_address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid agent address format: </span><span class="si">{</span><span class="n">agent_address</span><span class="si">}</span><span class="s2">. Expected format: agent_id@plaza_name&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span>
        
        <span class="c1"># Check if we&#39;re calling ourselves</span>
        <span class="k">if</span> <span class="n">agent_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Practice </span><span class="si">{</span><span class="n">practice</span><span class="si">}</span><span class="s2"> is on our agent, using local practice&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            
            <span class="c1"># Handle pit/practice format (e.g., &quot;ollama/Chat&quot;)</span>
            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">practice</span><span class="p">:</span>
                <span class="n">pit_name</span><span class="p">,</span> <span class="n">practice_name</span> <span class="o">=</span> <span class="n">practice</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking for pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2"> with practice </span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                
                <span class="c1"># Find the pit</span>
                <span class="k">for</span> <span class="n">pit_type</span><span class="p">,</span> <span class="n">pits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">pit_name</span> <span class="ow">in</span> <span class="n">pits</span><span class="p">:</span>
                        <span class="n">pit</span> <span class="o">=</span> <span class="n">pits</span><span class="p">[</span><span class="n">pit_name</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pit</span><span class="p">,</span> <span class="s1">&#39;practices&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">practice_name</span> <span class="ow">in</span> <span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found practice </span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> in pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                            <span class="c1"># Call the practice directly on the pit</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">practice_func</span> <span class="o">=</span> <span class="n">pit</span><span class="o">.</span><span class="n">practices</span><span class="p">[</span><span class="n">practice_name</span><span class="p">]</span><span class="o">.</span><span class="n">function</span>
                                <span class="n">result</span> <span class="o">=</span> <span class="n">practice_func</span><span class="p">(</span><span class="o">**</span><span class="n">practice_input</span><span class="p">)</span>
                                <span class="c1"># Wrap result in dict if needed</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                                    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>
                                <span class="k">return</span> <span class="n">result</span>
                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error calling practice </span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> on pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2"> not found or practice </span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> not in pit&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Pit </span><span class="si">{</span><span class="n">pit_name</span><span class="si">}</span><span class="s2"> not found or practice </span><span class="si">{</span><span class="n">practice_name</span><span class="si">}</span><span class="s2"> not in pit&quot;</span><span class="p">}</span>
                            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UsePractice</span><span class="p">(</span><span class="n">practice</span><span class="p">,</span> <span class="o">**</span><span class="n">practice_input</span><span class="p">)</span>
        
        <span class="c1"># Use the SendMessage method to call the practice on the remote agent</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Send the request through the plaza</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending request to agent </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> with practice </span><span class="si">{</span><span class="n">practice</span><span class="si">}</span><span class="s2"> and input </span><span class="si">{</span><span class="n">practice_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advertising on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Advertise</span><span class="p">(</span><span class="n">plaza_name</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">UsePracticeRequest</span><span class="p">(</span><span class="n">practice</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="o">+</span><span class="s1">&#39;@&#39;</span><span class="o">+</span><span class="n">plaza_name</span><span class="p">,</span> <span class="p">[</span><span class="n">AgentAddress</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">)],</span> <span class="n">arguments</span><span class="o">=</span><span class="n">practice_input</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">[</span><span class="n">AgentAddress</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">plaza_name</span><span class="p">)]):</span>
                <span class="c1"># wait for max 20 seconds for a response</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveMessage</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received result from agent </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
                        <span class="c1">#print(f&quot;Result: {result}&quot;)</span>
                        <span class="k">return</span> <span class="n">result</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No response from agent </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> after 10 seconds&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;No response from agent </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2"> after 10 seconds&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send message to agent </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Failed to send message to agent </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on plaza </span><span class="si">{</span><span class="n">plaza_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error using remote practice </span><span class="si">{</span><span class="n">practice</span><span class="si">}</span><span class="s2"> on agent </span><span class="si">{</span><span class="n">agent_address</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Alvin Cho.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>